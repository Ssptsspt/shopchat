<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShopChat - Improved</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js" type="module"></script>
</head>
<body>
  <h1>ShopChat ðŸš€</h1>  <!-- Login / Signup -->  <div id="auth-section">
    <input id="email" placeholder="Email"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <select id="role">
      <option value="customer">Customer</option>
      <option value="owner">Shop Owner</option>
    </select><br>
    <button id="signupBtn">Sign Up</button>
    <button id="loginBtn">Log In</button>
  </div>  <!-- Shop Owner Dashboard -->  <div id="owner-section" style="display:none;">
    <h2>Owner Dashboard</h2>
    <input id="productName" placeholder="Product Name"><br>
    <input id="productPrice" placeholder="Price"><br>
    <input id="productDesc" placeholder="Description"><br>
    <input id="productImg" placeholder="Image URL"><br>
    <button id="addProductBtn">Add Product</button><h3>Your Products</h3>
<ul id="ownerProducts"></ul>

  </div>  <!-- Customer Dashboard -->  <div id="customer-section" style="display:none;">
    <h2>Browse Shops</h2>
    <ul id="shopList"></ul><div id="shopProducts"></div>

  </div>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, addDoc, onSnapshot, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // âœ… Your fixed Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDLcmJcAnXzNVd8gfN6dUhMKblyKFBZ4Yo",
      authDomain: "shopchat-fac01.firebaseapp.com",
      projectId: "shopchat-fac01",
      storageBucket: "shopchat-fac01.appspot.com",
      messagingSenderId: "302386314009",
      appId: "1:302386314009:web:f05f679ea841c88be72388",
      databaseURL: "https://shopchat-fac01-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const signupBtn = document.getElementById("signupBtn");
    const loginBtn = document.getElementById("loginBtn");

    let currentUser = null;
    let userRole = "customer";

    signupBtn.onclick = async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const role = document.getElementById("role").value;
      const userCred = await createUserWithEmailAndPassword(auth, email, password);
      await setDoc(doc(db, "users", userCred.user.uid), { role });
      currentUser = userCred.user;
      userRole = role;
      showDashboard(role);
    };

    loginBtn.onclick = async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const role = document.getElementById("role").value;
      const userCred = await signInWithEmailAndPassword(auth, email, password);
      const docSnap = await getDoc(doc(db, "users", userCred.user.uid));
      currentUser = userCred.user;
      userRole = docSnap.exists() ? docSnap.data().role : role;
      showDashboard(userRole);
    };

    function showDashboard(role) {
      document.getElementById("auth-section").style.display = "none";
      if (role === "owner") {
        document.getElementById("owner-section").style.display = "block";
        loadOwnerProducts();
      } else {
        document.getElementById("customer-section").style.display = "block";
        loadShops();
      }
    }

    // ðŸ”¹ Shop Owner adds product
    document.getElementById("addProductBtn").onclick = async () => {
      const name = document.getElementById("productName").value;
      const price = document.getElementById("productPrice").value;
      const desc = document.getElementById("productDesc").value;
      const img = document.getElementById("productImg").value;

      await addDoc(collection(db, "products"), {
        ownerId: currentUser.uid,
        name,
        price,
        desc,
        img
      });
    };

    function loadOwnerProducts() {
      const q = query(collection(db, "products"), where("ownerId", "==", currentUser.uid));
      onSnapshot(q, (snapshot) => {
        const list = document.getElementById("ownerProducts");
        list.innerHTML = "";
        snapshot.forEach(doc => {
          const data = doc.data();
          list.innerHTML += `<li>${data.name} - â‚¹${data.price}</li>`;
        });
      });
    }

    function loadShops() {
      const q = query(collection(db, "users"), where("role", "==", "owner"));
      onSnapshot(q, (snapshot) => {
        const list = document.getElementById("shopList");
        list.innerHTML = "";
        snapshot.forEach(docu => {
          const data = docu.data();
          const li = document.createElement("li");
          li.textContent = `Shop Owner: ${docu.id}`;
          li.onclick = () => loadProducts(docu.id);
          list.appendChild(li);
        });
      });
    }

    function loadProducts(ownerId) {
      const q = query(collection(db, "products"), where("ownerId", "==", ownerId));
      const container = document.getElementById("shopProducts");
      onSnapshot(q, (snapshot) => {
        container.innerHTML = "<h3>Products</h3>";
        snapshot.forEach(doc => {
          const data = doc.data();
          container.innerHTML += `<div><img src="${data.img}" width="80"><br>${data.name} - â‚¹${data.price}<br>${data.desc}</div><hr>`;
        });
      });
    }
  </script></body>
      </html>
